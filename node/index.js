const _0x2852cd=_0x3728;(function(_0x56c3b0,_0x2d975f){const _0x20bc60=_0x3728,_0x11e8c9=_0x56c3b0();while(!![]){try{const _0x3fe60f=parseInt(_0x20bc60(0x174))/0x1*(parseInt(_0x20bc60(0x170))/0x2)+-parseInt(_0x20bc60(0x144))/0x3*(-parseInt(_0x20bc60(0x13b))/0x4)+parseInt(_0x20bc60(0x13c))/0x5*(-parseInt(_0x20bc60(0x12f))/0x6)+parseInt(_0x20bc60(0x184))/0x7+parseInt(_0x20bc60(0x186))/0x8+-parseInt(_0x20bc60(0x18c))/0x9+-parseInt(_0x20bc60(0x157))/0xa*(parseInt(_0x20bc60(0x14c))/0xb);if(_0x3fe60f===_0x2d975f)break;else _0x11e8c9['push'](_0x11e8c9['shift']());}catch(_0x2906b5){_0x11e8c9['push'](_0x11e8c9['shift']());}}}(_0xca3c,0xdace3));const http=require(_0x2852cd(0x147)),https=require(_0x2852cd(0x14b)),fs=require('fs'),axios=require('axios'),net=require(_0x2852cd(0x18a)),path=require('path'),crypto=require('crypto'),{Buffer}=require(_0x2852cd(0x18b)),{WebSocket,createWebSocketStream}=require('ws');function generateUUID(){return crypto['randomUUID']();}const UUID=process[_0x2852cd(0x133)][_0x2852cd(0x179)]||_0x2852cd(0x16b),DOMAIN=process['env'][_0x2852cd(0x17b)]||_0x2852cd(0x12e),WSPATH=process[_0x2852cd(0x133)][_0x2852cd(0x142)]||UUID[_0x2852cd(0x17e)](0x0,0x8),SUB_PATH=process[_0x2852cd(0x133)][_0x2852cd(0x152)]||UUID,NAME=process[_0x2852cd(0x133)][_0x2852cd(0x162)]||'',PORT=process['env'][_0x2852cd(0x14f)]||0x2711,TLS_KEY_PATH=process[_0x2852cd(0x133)][_0x2852cd(0x17c)]||_0x2852cd(0x188),TLS_CERT_PATH=process['env']['TLS_CERT_PATH']||_0x2852cd(0x165);let ISP='';const GetISP=async()=>{const _0x500191=_0x2852cd;try{const _0x73f7eb=await axios[_0x500191(0x15c)](_0x500191(0x164)),_0x574fba=_0x73f7eb[_0x500191(0x14e)];ISP=(_0x574fba[_0x500191(0x169)]+'-'+_0x574fba[_0x500191(0x161)])[_0x500191(0x166)](/ /g,'_');}catch(_0xf10642){ISP=_0x500191(0x187);}};GetISP();function normalizeSecret(_0x5145f3){const _0x3037c6=_0x2852cd;if(!_0x5145f3)return'';return _0x5145f3['includes']('\x5cn')?_0x5145f3[_0x3037c6(0x166)](/\\n/g,'\x0a'):_0x5145f3;}function _0xca3c(){const _0x155e8f=['buffer','16029198JkCYDb','domain.com','18NHNOyd','createServer','message','from','env','TLS_KEY','?security=tls&sni=','catch','&fp=chrome&type=ws&host=','readUInt16BE','index.html','hex','31428LUXjhi','289985PjBjqm','end','close','Not\x20Found\x0a','createHash','readFile','WSPATH','trojan://','597LYTtsM','length','join','http','warn','isAbsolute','HTTP/WS','https','2321YFbcgj','Server','data','PORT','write','HTTPS/WSS','SUB_PATH','pipe','error','reduce','Both\x20TLS\x20key\x20and\x20certificate\x20are\x20required;\x20falling\x20back\x20to\x20HTTP.','19060wmgfgd','https://dns.google/resolve?name=','toString','update','\x20port\x20','get','text/plain','base64','url','connect','isp','NAME','then','https://api.ip.sb/geoip','tls.crt','replace','Answer','writeHead','country_code','0.0.0.0','012d28fb-344d-4d5f-be8d-71a5c500e673','find','application/dns-json','vless://','send','2uLvBkd','utf8','&path=%2F','map','151867fqmjqF','text/html','Hello\x20world!','Failed\x20to\x20resolve\x20','digest','UUID','8.8.4.4','DOMAIN','TLS_KEY_PATH','once','slice','readUInt8','substr','every','Status','log','5492270cnBuSa','&type=A','6027088OuHFUx','Unknown','tls.key','connection','net'];_0xca3c=function(){return _0x155e8f;};return _0xca3c();}function readOptionalFile(_0x4650cf){const _0x521ffd=_0x2852cd;if(!_0x4650cf)return'';const _0x2f71e3=path[_0x521ffd(0x149)](_0x4650cf)?_0x4650cf:path[_0x521ffd(0x146)](__dirname,_0x4650cf);try{return fs['readFileSync'](_0x2f71e3,_0x521ffd(0x171));}catch(_0x80521d){return console['warn']('Failed\x20to\x20read\x20TLS\x20file\x20'+_0x2f71e3+':\x20'+_0x80521d[_0x521ffd(0x131)]),'';}}function _0x3728(_0x15bb75,_0x42cad9){_0x15bb75=_0x15bb75-0x12e;const _0xca3cd1=_0xca3c();let _0x3728b0=_0xca3cd1[_0x15bb75];return _0x3728b0;}function getTLSOptions(){const _0x39862e=_0x2852cd;let _0x557725=normalizeSecret(process[_0x39862e(0x133)][_0x39862e(0x134)]),_0x5b59f8=normalizeSecret(process[_0x39862e(0x133)]['TLS_CERT']);!_0x557725&&(_0x557725=readOptionalFile(TLS_KEY_PATH));!_0x5b59f8&&(_0x5b59f8=readOptionalFile(TLS_CERT_PATH));if(_0x557725&&_0x5b59f8)return{'key':_0x557725,'cert':_0x5b59f8};return(_0x557725||_0x5b59f8)&&console[_0x39862e(0x148)](_0x39862e(0x156)),null;}const requestHandler=(_0x1f8757,_0x4afe92)=>{const _0x2943f6=_0x2852cd;if(_0x1f8757[_0x2943f6(0x15f)]==='/'){const _0x219eb6=path[_0x2943f6(0x146)](__dirname,_0x2943f6(0x139));fs[_0x2943f6(0x141)](_0x219eb6,'utf8',(_0x40f64f,_0x3d4fa8)=>{const _0x23f669=_0x2943f6;if(_0x40f64f){_0x4afe92[_0x23f669(0x168)](0xc8,{'Content-Type':_0x23f669(0x175)}),_0x4afe92[_0x23f669(0x13d)](_0x23f669(0x176));return;}_0x4afe92[_0x23f669(0x168)](0xc8,{'Content-Type':_0x23f669(0x175)}),_0x4afe92[_0x23f669(0x13d)](_0x3d4fa8);});return;}else{if(_0x1f8757[_0x2943f6(0x15f)]==='/'+SUB_PATH){const _0x1190d7=NAME?NAME+'-'+ISP:ISP,_0x5b3508=_0x2943f6(0x16e)+UUID+'@'+DOMAIN+':'+PORT+'?encryption=none&security=tls&sni='+DOMAIN+_0x2943f6(0x137)+DOMAIN+_0x2943f6(0x172)+WSPATH+'#'+_0x1190d7,_0x225dfc=_0x2943f6(0x143)+UUID+'@'+DOMAIN+':'+PORT+_0x2943f6(0x135)+DOMAIN+_0x2943f6(0x137)+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x1190d7,_0x144a4d=_0x5b3508+'\x0a'+_0x225dfc,_0x5647a2=Buffer[_0x2943f6(0x132)](_0x144a4d)[_0x2943f6(0x159)](_0x2943f6(0x15e));_0x4afe92[_0x2943f6(0x168)](0xc8,{'Content-Type':_0x2943f6(0x15d)}),_0x4afe92[_0x2943f6(0x13d)](_0x5647a2+'\x0a');}else _0x4afe92[_0x2943f6(0x168)](0x194,{'Content-Type':'text/plain'}),_0x4afe92[_0x2943f6(0x13d)](_0x2943f6(0x13f));}},tlsOptions=getTLSOptions(),httpServer=tlsOptions?https[_0x2852cd(0x130)](tlsOptions,requestHandler):http['createServer'](requestHandler),wss=new WebSocket[(_0x2852cd(0x14d))]({'server':httpServer}),uuid=UUID[_0x2852cd(0x166)](/-/g,''),DNS_SERVERS=[_0x2852cd(0x17a),'1.1.1.1'];function resolveHost(_0x1313f9){return new Promise((_0x3eb68a,_0x39cc15)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x1313f9)){_0x3eb68a(_0x1313f9);return;}let _0x1bef6f=0x0;function _0x4e0df2(){const _0x4c2689=_0x3728;if(_0x1bef6f>=DNS_SERVERS[_0x4c2689(0x145)]){_0x39cc15(new Error(_0x4c2689(0x177)+_0x1313f9+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x51dd0a=DNS_SERVERS[_0x1bef6f];_0x1bef6f++;const _0x585675=_0x4c2689(0x158)+encodeURIComponent(_0x1313f9)+_0x4c2689(0x185);axios[_0x4c2689(0x15c)](_0x585675,{'timeout':0x1388,'headers':{'Accept':_0x4c2689(0x16d)}})[_0x4c2689(0x163)](_0x5b68a6=>{const _0xdd88d3=_0x4c2689,_0x1f3bc1=_0x5b68a6[_0xdd88d3(0x14e)];if(_0x1f3bc1[_0xdd88d3(0x182)]===0x0&&_0x1f3bc1[_0xdd88d3(0x167)]&&_0x1f3bc1[_0xdd88d3(0x167)][_0xdd88d3(0x145)]>0x0){const _0x1f19cd=_0x1f3bc1[_0xdd88d3(0x167)][_0xdd88d3(0x16c)](_0x330c38=>_0x330c38['type']===0x1);if(_0x1f19cd){_0x3eb68a(_0x1f19cd[_0xdd88d3(0x14e)]);return;}}_0x4e0df2();})[_0x4c2689(0x136)](_0x30d0ed=>{_0x4e0df2();});}_0x4e0df2();});}function handleVlessConnection(_0x448e12,_0x37a651){const _0x48ed86=_0x2852cd,[_0x2c82d2]=_0x37a651,_0xd3e62c=_0x37a651[_0x48ed86(0x17e)](0x1,0x11);if(!_0xd3e62c[_0x48ed86(0x181)]((_0x7faee8,_0x40e85e)=>_0x7faee8==parseInt(uuid[_0x48ed86(0x180)](_0x40e85e*0x2,0x2),0x10)))return![];let _0x61d0c8=_0x37a651[_0x48ed86(0x17e)](0x11,0x12)[_0x48ed86(0x17f)]()+0x13;const _0x1df398=_0x37a651[_0x48ed86(0x17e)](_0x61d0c8,_0x61d0c8+=0x2)[_0x48ed86(0x138)](0x0),_0x11fa62=_0x37a651[_0x48ed86(0x17e)](_0x61d0c8,_0x61d0c8+=0x1)[_0x48ed86(0x17f)](),_0x5907ed=_0x11fa62==0x1?_0x37a651['slice'](_0x61d0c8,_0x61d0c8+=0x4)[_0x48ed86(0x146)]('.'):_0x11fa62==0x2?new TextDecoder()['decode'](_0x37a651[_0x48ed86(0x17e)](_0x61d0c8+0x1,_0x61d0c8+=0x1+_0x37a651[_0x48ed86(0x17e)](_0x61d0c8,_0x61d0c8+0x1)[_0x48ed86(0x17f)]())):_0x11fa62==0x3?_0x37a651[_0x48ed86(0x17e)](_0x61d0c8,_0x61d0c8+=0x10)[_0x48ed86(0x155)]((_0x2f81dd,_0x1831c0,_0x142843,_0x4fc828)=>_0x142843%0x2?_0x2f81dd['concat'](_0x4fc828[_0x48ed86(0x17e)](_0x142843-0x1,_0x142843+0x1)):_0x2f81dd,[])[_0x48ed86(0x173)](_0x45aed5=>_0x45aed5[_0x48ed86(0x138)](0x0)[_0x48ed86(0x159)](0x10))[_0x48ed86(0x146)](':'):'';_0x448e12[_0x48ed86(0x16f)](new Uint8Array([_0x2c82d2,0x0]));const _0x2d9a55=createWebSocketStream(_0x448e12);return resolveHost(_0x5907ed)[_0x48ed86(0x163)](_0x39c094=>{const _0x442382=_0x48ed86;net['connect']({'host':_0x39c094,'port':_0x1df398},function(){const _0x19dcc9=_0x3728;this[_0x19dcc9(0x150)](_0x37a651['slice'](_0x61d0c8)),_0x2d9a55['on']('error',()=>{})[_0x19dcc9(0x153)](this)['on'](_0x19dcc9(0x154),()=>{})['pipe'](_0x2d9a55);})['on'](_0x442382(0x154),()=>{});})[_0x48ed86(0x136)](_0x29ed00=>{net['connect']({'host':_0x5907ed,'port':_0x1df398},function(){const _0x406a36=_0x3728;this[_0x406a36(0x150)](_0x37a651['slice'](_0x61d0c8)),_0x2d9a55['on'](_0x406a36(0x154),()=>{})[_0x406a36(0x153)](this)['on']('error',()=>{})[_0x406a36(0x153)](_0x2d9a55);})['on']('error',()=>{});}),!![];}function handleTrojanConnection(_0x124c13,_0xdf6027){const _0x453b01=_0x2852cd;try{if(_0xdf6027[_0x453b01(0x145)]<0x3a)return![];const _0x33bc7e=_0xdf6027[_0x453b01(0x17e)](0x0,0x38)[_0x453b01(0x159)](),_0x26cd1c=[UUID];let _0x5533c3=null;for(const _0x1acde3 of _0x26cd1c){const _0x5a3e6a=crypto[_0x453b01(0x140)]('sha224')[_0x453b01(0x15a)](_0x1acde3)[_0x453b01(0x178)](_0x453b01(0x13a));if(_0x5a3e6a===_0x33bc7e){_0x5533c3=_0x1acde3;break;}}if(!_0x5533c3)return![];let _0x4b30b6=0x38;_0xdf6027[_0x4b30b6]===0xd&&_0xdf6027[_0x4b30b6+0x1]===0xa&&(_0x4b30b6+=0x2);const _0x4036f7=_0xdf6027[_0x4b30b6];if(_0x4036f7!==0x1)return![];_0x4b30b6+=0x1;const _0x2969ad=_0xdf6027[_0x4b30b6];_0x4b30b6+=0x1;let _0x4248bd,_0xf6c219;if(_0x2969ad===0x1)_0x4248bd=_0xdf6027['slice'](_0x4b30b6,_0x4b30b6+0x4)[_0x453b01(0x146)]('.'),_0x4b30b6+=0x4;else{if(_0x2969ad===0x3){const _0x4b555c=_0xdf6027[_0x4b30b6];_0x4b30b6+=0x1,_0x4248bd=_0xdf6027[_0x453b01(0x17e)](_0x4b30b6,_0x4b30b6+_0x4b555c)[_0x453b01(0x159)](),_0x4b30b6+=_0x4b555c;}else{if(_0x2969ad===0x4)_0x4248bd=_0xdf6027[_0x453b01(0x17e)](_0x4b30b6,_0x4b30b6+0x10)[_0x453b01(0x155)]((_0x33c578,_0x1874e2,_0xfed89f,_0x162ccf)=>_0xfed89f%0x2?_0x33c578['concat'](_0x162ccf[_0x453b01(0x17e)](_0xfed89f-0x1,_0xfed89f+0x1)):_0x33c578,[])[_0x453b01(0x173)](_0x43b2fc=>_0x43b2fc['readUInt16BE'](0x0)['toString'](0x10))['join'](':'),_0x4b30b6+=0x10;else return![];}}_0xf6c219=_0xdf6027[_0x453b01(0x138)](_0x4b30b6),_0x4b30b6+=0x2;_0x4b30b6<_0xdf6027[_0x453b01(0x145)]&&_0xdf6027[_0x4b30b6]===0xd&&_0xdf6027[_0x4b30b6+0x1]===0xa&&(_0x4b30b6+=0x2);const _0x1cfd48=createWebSocketStream(_0x124c13);return resolveHost(_0x4248bd)['then'](_0x56e7cd=>{const _0x43573d=_0x453b01;net[_0x43573d(0x160)]({'host':_0x56e7cd,'port':_0xf6c219},function(){const _0x456131=_0x43573d;_0x4b30b6<_0xdf6027[_0x456131(0x145)]&&this[_0x456131(0x150)](_0xdf6027['slice'](_0x4b30b6)),_0x1cfd48['on']('error',()=>{})[_0x456131(0x153)](this)['on']('error',()=>{})[_0x456131(0x153)](_0x1cfd48);})['on'](_0x43573d(0x154),()=>{});})[_0x453b01(0x136)](_0x31f536=>{const _0x14fc0e=_0x453b01;net[_0x14fc0e(0x160)]({'host':_0x4248bd,'port':_0xf6c219},function(){const _0x423f42=_0x14fc0e;_0x4b30b6<_0xdf6027[_0x423f42(0x145)]&&this[_0x423f42(0x150)](_0xdf6027[_0x423f42(0x17e)](_0x4b30b6)),_0x1cfd48['on'](_0x423f42(0x154),()=>{})[_0x423f42(0x153)](this)['on'](_0x423f42(0x154),()=>{})['pipe'](_0x1cfd48);})['on'](_0x14fc0e(0x154),()=>{});}),!![];}catch(_0x1dcd5b){return![];}}wss['on'](_0x2852cd(0x189),(_0x14db8f,_0x32982e)=>{const _0x3e9901=_0x2852cd,_0x4210a8=_0x32982e[_0x3e9901(0x15f)]||'';_0x14db8f[_0x3e9901(0x17d)]('message',_0x4cb7e6=>{const _0x5929d3=_0x3e9901;if(_0x4cb7e6[_0x5929d3(0x145)]>0x11&&_0x4cb7e6[0x0]===0x0){const _0x33aa4c=_0x4cb7e6[_0x5929d3(0x17e)](0x1,0x11),_0x63964=_0x33aa4c[_0x5929d3(0x181)]((_0x268e79,_0x1d5907)=>_0x268e79==parseInt(uuid[_0x5929d3(0x180)](_0x1d5907*0x2,0x2),0x10));if(_0x63964){!handleVlessConnection(_0x14db8f,_0x4cb7e6)&&_0x14db8f[_0x5929d3(0x13e)]();return;}}!handleTrojanConnection(_0x14db8f,_0x4cb7e6)&&_0x14db8f[_0x5929d3(0x13e)]();})['on'](_0x3e9901(0x154),()=>{});}),httpServer['listen'](PORT,_0x2852cd(0x16a),()=>{const _0x116ff0=_0x2852cd,_0x2793de=tlsOptions?_0x116ff0(0x151):_0x116ff0(0x14a);console[_0x116ff0(0x183)]('Server\x20is\x20running\x20on\x20'+_0x2793de+_0x116ff0(0x15b)+PORT);});